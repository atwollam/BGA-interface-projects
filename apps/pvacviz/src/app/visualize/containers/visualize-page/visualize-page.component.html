<div class="page-header">
  <div class="row">
    <div class="col-xs-6">
      <h3 class="page-title">
        <span class="page-type">Visualize Process Results</span>
      </h3>
    </div>
    <div class="col-xs-6">
      <h3 class="page-title">
        <span class="page-type">Visualize Dropbox Files</span>
      </h3>
    </div>
  </div>
</div>
<div class="page-content">
  <div class="row">
    <div class="col-xs-6">
      <p *ngIf="(processesWithVisualizableFiles$ | async)?.length < 1">
        No processes found with visualizable files.
      </p>
      <div class="card" *ngFor="let process of (processesWithVisualizableFiles$ | async)">
        <div class="card-header">
          <div class="row">
            <div class="col-xs-12">
              {{process.parameters.samplename}}
              <span class="p5">&nbsp;&nbsp;Output directory:&nbsp;~/pVACseq/{{ process.parameters.output}}</span>
            </div>
          </div>
        </div>
        <div class="card-block files">
          <div class="card-text">
            <table class="table table-compact table-noborder file-table">
              <thead>
                <tr>
                  <th class="left">Filename</th>
                  <th class="left">Description</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <ng-container [ngSwitch]="process.files.length > 0">
                  <ng-container *ngSwitchCase="true">
                    <ng-container *ngFor="let file of process.files">
                      <tr *ngIf="file.is_visualizable === true">
                        <td class="left">{{file.display_name.split('/').slice(-1)}}</td>
                        <td class="left">{{file.description}}</td>
                        <td class="right">
                          <button [routerLink]="['/visualize/process', process.id, 'results', file.fileID]" class="btn btn-sm btn-link">Visualize</button>
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngSwitchCase="false">
                    <tr>
                      <td colspan="3">
                        Process produced no files.
                      </td>
                    </tr>
                  </ng-container>
                </ng-container>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
    <div class="col-xs-6">
      <p *ngIf="(dropboxFiles$ | async)?.length < 1">
        No visualizable files found in ~/pVACseq/Dropbox/
      </p>
      <div class="card" *ngIf="(dropboxFiles$ | async)?.length > 0">
        <div class="card-block files">
          <div class="card-text">
            <table class="table table-compact table-noborder file-table">
              <ng-template #dropboxFiles let-files let-parent="parent">
                <ng-container *ngFor="let node of files">
                  <ng-container [ngSwitch]="node.type">
                    <ng-container *ngSwitchCase="'directory'">
                      <tr class="directory">
                        <td colspan="3">{{ parent + node.display_name + '/' }}</td>
                      </tr>
                      <tr>
                        <th class="left">Filename</th>
                        <th class="left">Description</th>
                        <th></th>
                      </tr>
                      <ng-container *ngTemplateOutlet="dropboxFiles; context: {$implicit: node.contents, parent: parent + node.display_name + '/'}"></ng-container>
                    </ng-container>
                    <ng-container *ngSwitchCase="'file'">
                      <tr>
                        <td class="left">{{node.display_name}}</td>
                        <td class="left">{{node.description}}</td>
                        <td class="right">
                          <button [routerLink]="['/visualize/process', '-1', 'results', node.fileID]"
                            class="btn btn-sm btn-link"
                            [disabled]="!node.is_visualizable">
                            Visualize
                          </button>
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </ng-template>
              <ng-container *ngTemplateOutlet="dropboxFiles; context: { $implicit: (dropboxFiles$ | async), parent: '~/pVAC-Seq/dropbox/' }"></ng-container>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
